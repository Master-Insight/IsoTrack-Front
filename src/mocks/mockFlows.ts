import type { FlowDetailRecord, FlowNodeMetadata, FlowEdgeMetadata } from '@/features/flows/types'

const auditNodeMeta: FlowNodeMetadata = {
  notes: 'Checklist guiado para auditar, registrar hallazgos y notificar al owner.',
  artifacts: ['MQ-01', 'PR-ONB-02'],
  roles: ['QA Lead'],
  userAssigned: 'qa_auditor',
  visibleFor: ['Root', 'QA'],
  documents: ['DOC-PLAN-01', 'DOC-PLAN-02'],
  processes: ['PROC-01'],
  tasks: [
    { label: 'Checklist inicial', status: 'pendiente' },
    { label: 'Asignar auditor', status: 'en curso' },
  ],
}

const findingMeta: FlowNodeMetadata = {
  notes: 'Carga y categorización del hallazgo con evidencias asociadas.',
  artifacts: ['CAPA-01'],
  roles: ['Auditor', 'Owner de proceso'],
  userAssigned: 'owner_proc',
  visibleFor: ['QA', 'Owner proceso'],
  documents: ['DOC-HALL-01'],
  processes: ['PROC-02'],
  tasks: [
    { label: 'Cargar evidencia', status: 'en curso' },
    { label: 'Asignar severidad', status: 'pendiente' },
  ],
}

const integrationMeta: FlowNodeMetadata = {
  notes: 'Sincroniza NCR en SAP y refleja estados de orden de trabajo.',
  artifacts: ['EXT-ERP'],
  roles: ['Integraciones'],
  visibleFor: ['Root'],
  documents: [],
  processes: ['PROC-ERP'],
  tasks: [{ label: 'Validar webhook', status: 'completada' }],
}

const closureMeta: FlowNodeMetadata = {
  notes: 'Revisión de acciones correctivas y cierre formal del ciclo CAPA.',
  artifacts: ['CAPA-RESUMEN'],
  roles: ['QA Lead', 'Owner proceso'],
  visibleFor: ['QA'],
  documents: ['DOC-CIERRE-01'],
  processes: ['PROC-CAPA'],
  tasks: [
    { label: 'Revisar acciones', status: 'en curso' },
    { label: 'Publicar informe', status: 'pendiente' },
  ],
}

const defaultEdgeMeta: FlowEdgeMetadata = { style: 'default' }
const decisionEdgeMeta: FlowEdgeMetadata = { style: 'decision' }

export const mockFlows: FlowDetailRecord[] = [
  {
    id: 'flow-auditoria',
    title: 'Auditoría interna',
    description: 'Checklist de hallazgos, NCR y seguimiento CAPA.',
    type: 'auditoria',
    tags: ['QA', 'Auditoría'],
    area: 'Calidad',
    visibility: 'public',
    visibility_roles: ['QA'],
    company_id: 'demo-company',
    created_at: '2024-10-01T12:00:00Z',
    updated_at: '2024-11-02T12:00:00Z',
    nodes: [
      {
        id: 'node-plan',
        label: 'Planificación',
        type: 'step',
        system: 'IsoTrack',
        code: 'AUD-01',
        metadata: auditNodeMeta,
        position: { x: 80, y: 140 },
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'node-hallazgo',
        label: 'Hallazgo',
        type: 'event',
        system: 'IsoTrack',
        code: 'AUD-02',
        metadata: findingMeta,
        position: { x: 360, y: 220 },
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'node-integracion',
        label: 'Integración ERP',
        type: 'integration',
        system: 'SAP',
        code: 'AUD-03',
        metadata: integrationMeta,
        position: { x: 620, y: 260 },
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'node-cierre',
        label: 'Cierre CAPA',
        type: 'process',
        system: 'IsoTrack',
        code: 'AUD-04',
        metadata: closureMeta,
        position: { x: 880, y: 190 },
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
    ],
    edges: [
      {
        id: 'edge-plan-hallazgo',
        source_node: 'node-plan',
        target_node: 'node-hallazgo',
        label: 'Checklist de auditoría',
        metadata: defaultEdgeMeta,
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'edge-hallazgo-integracion',
        source_node: 'node-hallazgo',
        target_node: 'node-integracion',
        label: 'Webhook hallazgo',
        metadata: decisionEdgeMeta,
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'edge-integracion-cierre',
        source_node: 'node-integracion',
        target_node: 'node-cierre',
        label: 'Sincronizar CAPA',
        metadata: defaultEdgeMeta,
        flow_id: 'flow-auditoria',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
    ],
  },
  {
    id: 'flow-onboarding',
    title: 'Onboarding de planta',
    description: 'Flujo visual para ingreso a planta y asignación de recursos.',
    type: 'onboarding',
    tags: ['Operaciones'],
    area: 'Operaciones',
    visibility: 'area',
    visibility_roles: ['Operaciones'],
    company_id: 'demo-company',
    created_at: '2024-10-01T12:00:00Z',
    updated_at: '2024-11-01T12:00:00Z',
    nodes: [
      {
        id: 'node-checklist',
        label: 'Checklist de ingreso',
        type: 'step',
        system: 'IsoTrack',
        code: 'ONB-01',
        metadata: {
          notes: 'Checklist de salud, EPP y entrega de credenciales.',
          artifacts: ['CHK-01'],
          roles: ['Supervisor'],
          documents: ['DOC-ING-01'],
          tasks: [{ label: 'Validar exámenes', status: 'en curso' }],
        },
        position: { x: 120, y: 180 },
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'node-induccion',
        label: 'Inducción',
        type: 'process',
        system: 'IsoTrack',
        code: 'ONB-02',
        metadata: {
          notes: 'Sesión de inducción con video y tour por planta.',
          roles: ['RRHH'],
          documents: ['DOC-IND-01'],
          tasks: [{ label: 'Confirmar asistencia', status: 'pendiente' }],
        },
        position: { x: 420, y: 180 },
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'node-asignacion',
        label: 'Asignación de recursos',
        type: 'decision',
        system: 'IsoTrack',
        code: 'ONB-03',
        metadata: {
          notes: 'Asignación de lockers, EPP y accesos.',
          roles: ['Supervisor', 'TI'],
          tasks: [{ label: 'Registrar equipo', status: 'pendiente' }],
        },
        position: { x: 700, y: 140 },
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'node-cierre-onb',
        label: 'Cierre',
        type: 'event',
        system: 'IsoTrack',
        code: 'ONB-04',
        metadata: {
          notes: 'Confirmación final y entrega de usuario.',
          roles: ['RRHH'],
          tasks: [{ label: 'Entregar credencial', status: 'pendiente' }],
        },
        position: { x: 940, y: 200 },
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
    ],
    edges: [
      {
        id: 'edge-checklist-induccion',
        source_node: 'node-checklist',
        target_node: 'node-induccion',
        label: 'Checklist listo',
        metadata: defaultEdgeMeta,
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'edge-induccion-asignacion',
        source_node: 'node-induccion',
        target_node: 'node-asignacion',
        label: 'Inducción completada',
        metadata: decisionEdgeMeta,
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
      {
        id: 'edge-asignacion-cierre',
        source_node: 'node-asignacion',
        target_node: 'node-cierre-onb',
        label: 'Recursos asignados',
        metadata: defaultEdgeMeta,
        flow_id: 'flow-onboarding',
        company_id: 'demo-company',
        created_at: '2024-10-01T12:00:00Z',
        updated_at: '2024-10-01T12:00:00Z',
      },
    ],
  },
]

export function getMockFlowById(id: string) {
  return mockFlows.find((flow) => flow.id === id)
}
